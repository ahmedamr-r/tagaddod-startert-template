import { Meta, Story, Controls, Canvas, ArgTypes } from '@storybook/blocks';
import * as DrawerStories from './Drawer.stories';
import { Drawer, useDrawerContext } from './Drawer';

<Meta of={DrawerStories} />


REALM AGENT NAVIGATION INDEX
=============================
Quick Reference for Claude Code Agents:

üì¶ IMPORT & SETUP (Lines 15-57)
- Basic import pattern with useDrawerContext
- Props documentation  
- Header Props table (Lines 25-35)
- Header Layout CSS Classes (Lines 36-57)

üéØ Z-INDEX MANAGEMENT (Lines 59-91)
- Z-Index Hierarchy (Lines 63-68): Complex layering system
- DrawerContext System (Lines 69-91): Automatic z-index for child components

üéØ BASIC USAGE (Lines 92-123)
- Default implementation with trigger button
- Content padding configuration

üìê WIDTH CONFIGURATION (Lines 125-212)
- Default Width (Lines 129-144): 28.125rem (450px) recommended
- Custom Width (Lines 146-191): Custom sizes with constraints
- Width Constraints (Lines 193-198): Min/max rules
- Legacy Size Props (Lines 200-212): Backward compatibility

üìç POSITIONS (Lines 214-244)
- Right (Lines 218-231): Default position
- Left (Lines 233-244): Alternative position

üéõÔ∏è HEADER OPTIONS (Lines 246-332)
- With Back Button (Lines 248-262): Navigation support
- With Header Components (Lines 264-308): Badge/button integration
- Interactive Header Areas (Lines 304-308): Demo story
- Without Title (Lines 309-319): Minimal header
- Without Close Button (Lines 321-332): Custom close handling

ü¶∂ FOOTER (Lines 334-479)
- Footer Variants (Lines 338-422):
  * Cancel and Actions (Lines 340-369): Default pattern
  * Swap and Actions (Lines 371-398): Custom left content
  * Actions Only (Lines 400-422): Right-aligned buttons
- Single Button Footers (Lines 424-464): Primary/secondary only
- Footer Props Table (Lines 466-479): Complete prop reference

üîó MODAL INTEGRATION (Lines 481-560)
- Modal Components Within Drawer (Lines 481-536): Z-index management
- useDrawerContext Hook (Lines 538-560): Context access pattern

üé® VISUAL CUSTOMIZATION (Lines 561-614)
- Custom Padding (Lines 563-587): Design token options
- Width Testing (Lines 589-599): Interactive testing
- Full Height (Lines 601-614): Maximum height option

üåç INTERNATIONALIZATION & RTL SUPPORT (Lines 720-877)
- ThemeProvider Integration (Lines 724-748): Full RTL setup with Arabic content
- Automatic RTL Adjustments (Lines 750-760): 7 built-in RTL features
- Directional Icon Handling (Lines 762-802): Back arrow logic and examples
- RTL Position Logic (Lines 804-817): Automatic left positioning in RTL
- Line Height & Typography (Lines 819-833): Arabic text optimization
- RTL Testing Example (Lines 835-859): Arabic drawer implementation
- RTL Best Practices (Lines 861-870): 8 implementation guidelines
- Arabic Typography Notes (Lines 872-877): Font and rendering details

üíº USE CASES (Lines 879-1025)
- Form Entry (Lines 881-904): User input forms
- Content with Different Padding (Lines 906-938): Padding strategies
- Object Details with Table (Lines 940-966): Complex content
- Multi-step Flows (Lines 968-992): Wizard patterns
- Settings Panel (Lines 994-1008): Configuration UI
- Wide Content Drawer (Lines 1010-1025): Large displays

‚ôø ACCESSIBILITY (Lines 1027-1041)
- Modal dialog pattern
- Focus management and keyboard navigation

‚öôÔ∏è TECHNICAL DETAILS (Lines 1043-1106)
- Z-Index Architecture (Lines 1045-1062): CSS variable hierarchy
- CSS Variables (Lines 1064-1085): Design tokens used
- Architecture (Lines 1087-1103): Vaul foundation
- Browser Support (Lines 1104-1106)
- Mobile Behavior (Lines 1108-1115): Responsive design

üîß TROUBLESHOOTING (Lines 1117-1141)
- Z-index conflicts resolution
- Modal visibility issues
- Performance optimization

üöÄ COMPLEX INTEGRATION (Lines 1154-1234)
- Ultimate Z-Index Test (Lines 1157-1210): Drawer‚ÜíModal‚ÜíSelect
- Component Integration Features (Lines 1212-1224): Automatic detection
- Best Practices (Lines 1226-1234): Implementation guidelines

QUICK IMPLEMENTATION EXAMPLES:
- Basic drawer: Lines 201-226
- With back button: Lines 355-365
- Custom width: Lines 254-268
- With footer: Lines 449-472
- RTL support: Lines 840-859
- Modal integration: Lines 589-639

‚ö†Ô∏è Z-INDEX NOTE:
Drawer provides automatic z-index management through DrawerContext. Use useDrawerContext hook for modal components to ensure proper layering without manual configuration.

‚ö†Ô∏è FALLBACK INSTRUCTION:
If you cannot find what you're looking for in the sections above, 
read the ENTIRE document from start to finish to ensure complete 
understanding of all Drawer component capabilities and patterns.


# Drawer Component

The Drawer component is a side panel that slides in from the edge of the screen, providing additional content or actions without navigating away from the current page. It features proper z-index management to ensure it appears above all other content, including complex table layouts.

## Overview

Drawers are used to display supplementary content, forms, or detailed information while keeping the main context visible. They can appear from the right or left side of the screen and come in different sizes. The component automatically handles z-index stacking issues and provides context for nested modal components.

## Import

```jsx
import { Drawer, useDrawerContext } from '@tagaddod/react';
```

## Props

<ArgTypes of={Drawer} />

### Header Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `headerPrefix` | `React.ReactNode` | - | Content displayed in Group 1 after the title (e.g., badges, status indicators) |
| `headerSuffix` | `React.ReactNode` | - | Content displayed in Group 2 before the close button (e.g., action buttons, menus) |
| `showBackButton` | `boolean` | `false` | Show back button in Group 1 |
| `showTitle` | `boolean` | `true` | Show title in Group 1 |
| `showClose` | `boolean` | `true` | Show close button in Group 2 |
| `onBackClick` | `() => void` | - | Back button callback |

### Header Layout CSS Classes

The header uses these CSS classes for layout control:

```css
.header {
  display: flex;
  justify-content: space-between; /* Separates Group 1 and Group 2 */
}

.headerLeft {
  display: flex;
  gap: var(--t-space-200); /* 8px gaps in Group 1 */
  flex: 1; /* Takes available space */
}

.headerRight {
  display: flex;
  gap: var(--t-space-200); /* 8px gaps in Group 2 */
  flex-shrink: 0; /* Fixed size */
}
```

## Z-Index Management & Context System

The Drawer component uses a sophisticated z-index hierarchy and provides context to child components for proper layering:

### Z-Index Hierarchy
- **Drawer Overlay**: `calc(var(--t-z-drawer, 1020) - 1)` (1019) - Above all content but below drawer
- **Drawer Content**: `var(--t-z-drawer, 1020)` (1020) - Above overlay and below modals
- **Regular Modals**: `var(--t-z-modal, 1050)` (1050) - Above drawer content
- **Modals from Drawer**: `var(--t-z-drawer-modal, 1070)` (1070) - Highest priority for drawer context

### DrawerContext System

The Drawer provides context to all child components through `DrawerContext`:

```jsx
import { useDrawerContext } from '@tagaddod/react';

// Access drawer context in any child component
const { isInsideDrawer, drawerZIndex } = useDrawerContext();

// Example usage
if (isInsideDrawer) {
  // Component is inside a drawer
  // drawerZIndex = 1070 for modal components
}
```

**Context Properties:**
- `isInsideDrawer: boolean` - Indicates if component is inside a drawer
- `drawerZIndex: number` - Z-index value (1070) for modal components opened from drawer

This context system allows components like Modal and Select to automatically adjust their z-index when used within a drawer, ensuring proper stacking order without manual configuration.

## Basic Usage

<Canvas of={DrawerStories.Default} />

```jsx
import { useState } from 'react';
import { Drawer, Button } from '@tagaddod/react';

function MyComponent() {
  const [open, setOpen] = useState(false);
  
  return (
    <>
      <Button onClick={() => setOpen(true)}>
        Open Drawer
      </Button>
      
      <Drawer
        open={open}
        onOpenChange={setOpen}
        title="Drawer Title"
        contentPadding="var(--t-space-500)" // Default 20px padding
      >
        <div style={{ padding: '16px 0' }}>
          <p>This is a default drawer content.</p>
          <p>You can place any content here.</p>
        </div>
      </Drawer>
    </>
  );
}
```

## Width Configuration

The Drawer component supports flexible width configuration with both default and custom options:

### Default Width (Recommended)

The default width provides an optimal balance of content space and screen real estate at `28.125rem` (450px) with a minimum width of `25rem` (400px).

<Canvas of={DrawerStories.DefaultWidth} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Default Width Drawer"
  width="default" // This is the default value
>
  {/* Content */}
</Drawer>
```

### Custom Width

For specific use cases, you can set a custom width with optional minimum and maximum constraints:

<Canvas of={DrawerStories.CustomWidthTester} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Custom Width Drawer"
  width="custom"
  customWidth="35rem"
  minWidth="25rem"  // Always enforced (400px minimum)
  maxWidth="50rem"  // Optional maximum constraint
>
  {/* Content */}
</Drawer>
```

#### Custom Width Examples

```jsx
// Fixed rem-based width
<Drawer width="custom" customWidth="30rem" />

// Fixed pixel width  
<Drawer width="custom" customWidth="500px" />

// Viewport-based width
<Drawer width="custom" customWidth="40vw" />

// Responsive width with clamp
<Drawer 
  width="custom" 
  customWidth="clamp(25rem, 40vw, 50rem)" 
/>

// Custom width with constraints
<Drawer
  width="custom"
  customWidth="35rem"
  minWidth="25rem"   // 400px minimum (always enforced)
  maxWidth="60rem"   // 960px maximum
/>
```

### Width Constraints

- **Minimum Width**: Always `25rem` (400px) to ensure usability
- **Default Width**: `28.125rem` (450px) - optimal for most use cases
- **Custom Width**: Any valid CSS width value
- **Maximum Width**: Optional constraint for responsive designs

### Legacy Size Props

The `size` prop is still supported for backward compatibility but is separate from the width system:

```jsx
<Drawer
  size="medium"     // Controls internal layout/styling
  width="custom"    // Controls drawer width
  customWidth="40rem"
>
  {/* Content */}
</Drawer>
```

## Positions

The Drawer can appear from either side of the screen:

### Right (Default)

<Canvas of={DrawerStories.Default} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Right Drawer"
  position="right"
>
  {/* Content */}
</Drawer>
```

### Left

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Left Drawer"
  position="left"
>
  {/* Content */}
</Drawer>
```

## Header Options

### With Back Button

<Canvas of={DrawerStories.WithBackButton} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Step 1 of 3"
  showBackButton={true}
  onBackClick={handleBack}
>
  {/* Content */}
</Drawer>
```

### With Header Components

The Drawer header is organized into two distinct groups for better layout control:

```jsx
import { Badge } from '@tagaddod-design/react';

<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Drawer with Header Components"
  headerPrefix={<Badge tone="info">Status</Badge>}
  headerSuffix={<Button variant="plain" size="micro">Action</Button>}
>
  {/* Content */}
</Drawer>
```

#### Header Layout Structure

The header is divided into two groups with `justify-content: space-between`:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ [Back] Title [Prefix]     [space]     [Suffix] [Close] ‚îÇ
‚îÇ ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ Group 1 ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí                   ‚Üê‚îÄ Group 2 ‚îÄ‚Üí    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Group 1 (Left)**: Back button, Title, Prefix
- All items have `var(--t-space-200)` (8px) gaps between them
- Takes available space with `flex: 1`
- Title can expand or ellipsis within available space

**Group 2 (Right)**: Suffix, Close button  
- `var(--t-space-200)` (8px) gap between items
- Fixed size with `flex-shrink: 0`
- Always aligned to the right

### Interactive Header Areas

<Canvas of={DrawerStories.SwappableHeaderAreas} />

This interactive story demonstrates the header groups with various Badge and Button combinations.

### Without Title

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  showTitle={false}
>
  {/* Content */}
</Drawer>
```

### Without Close Button

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Without Close Button"
  showClose={false}
>
  {/* Content */}
</Drawer>
```

## Footer

The Drawer component supports multiple footer variants to accommodate different use cases and workflows.

### Footer Variants

#### Cancel and Actions (Default)

Shows a cancel button on the left and action buttons on the right. This is the most common pattern for forms and dialogs.

<Canvas of={DrawerStories.FooterCancelAndActions} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Cancel and Actions Footer"
  showFooter={true}
  footerVariant="cancelAndActions"
  cancelLabel="Cancel"
  primaryLabel="Save Changes"
  secondaryLabel="Save Draft"
  onCancel={() => setOpen(false)}
  onPrimary={() => {
    // Save action
    setOpen(false);
  }}
  onSecondary={() => {
    // Secondary action
  }}
  showPrimaryButton={true}
  showSecondaryButton={true}
>
  {/* Content */}
</Drawer>
```

#### Swap and Actions

Shows custom content on the left (like status or metadata) and action buttons on the right.

<Canvas of={DrawerStories.FooterSwapAndActions} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Swap and Actions Footer"
  showFooter={true}
  footerVariant="swapAndActions"
  primaryLabel="Publish"
  secondaryLabel="Save Draft"
  swapContent={
    <span style={{ color: 'var(--t-color-text-secondary)' }}>
      Status: Draft
    </span>
  }
  onPrimary={() => setOpen(false)}
  onSecondary={() => {}}
  showPrimaryButton={true}
  showSecondaryButton={true}
>
  {/* Content */}
</Drawer>
```

#### Actions Only

Shows only action buttons aligned to the right. Perfect for workflows where canceling is done via the close button.

<Canvas of={DrawerStories.FooterActionsOnly} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Actions Only Footer"
  showFooter={true}
  footerVariant="actionsOnly"
  primaryLabel="Confirm"
  secondaryLabel="Review"
  onPrimary={() => setOpen(false)}
  onSecondary={() => {}}
  showPrimaryButton={true}
  showSecondaryButton={true}
>
  {/* Content */}
</Drawer>
```

### Single Button Footers

#### Primary Button Only

<Canvas of={DrawerStories.FooterPrimaryOnly} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Primary Button Only"
  showFooter={true}
  footerVariant="actionsOnly"
  primaryLabel="Understand"
  onPrimary={() => setOpen(false)}
  showPrimaryButton={true}
  showSecondaryButton={false}
>
  {/* Content */}
</Drawer>
```

#### Secondary Button Only

<Canvas of={DrawerStories.FooterSecondaryOnly} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Secondary Button Only"
  showFooter={true}
  footerVariant="actionsOnly"
  secondaryLabel="Maybe Later"
  onSecondary={() => setOpen(false)}
  showPrimaryButton={false}
  showSecondaryButton={true}
>
  {/* Content */}
</Drawer>
```

### Footer Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `footerVariant` | `'cancelAndActions' \| 'swapAndActions' \| 'actionsOnly'` | `'cancelAndActions'` | The footer layout variant |
| `cancelLabel` | `string` | `'Cancel'` | Label for the cancel button |
| `primaryLabel` | `string` | `'Label'` | Label for the primary button |
| `secondaryLabel` | `string` | `'Label'` | Label for the secondary button |
| `showPrimaryButton` | `boolean` | `true` | Whether to show the primary button |
| `showSecondaryButton` | `boolean` | `true` | Whether to show the secondary button |
| `swapContent` | `React.ReactNode` | - | Custom content for the swap area |
| `onCancel` | `() => void` | - | Cancel button callback |
| `onPrimary` | `() => void` | - | Primary button callback |
| `onSecondary` | `() => void` | - | Secondary button callback |

## Modal Components Within Drawer

When you need to open modal components (like dialogs, popovers, or dropdowns) from within a drawer, use the `useDrawerContext` hook to ensure proper z-index layering:

```jsx
import { useState } from 'react';
import { Drawer, useDrawerContext, Modal, Button } from '@tagaddod/react';

function DrawerWithModal() {
  const [drawerOpen, setDrawerOpen] = useState(false);
  const [modalOpen, setModalOpen] = useState(false);
  
  return (
    <>
      <Button onClick={() => setDrawerOpen(true)}>
        Open Drawer
      </Button>
      
      <Drawer
        open={drawerOpen}
        onOpenChange={setDrawerOpen}
        title="Drawer with Modal"
      >
        <div style={{ padding: '16px 0' }}>
          <p>This drawer contains a modal that will appear above it.</p>
          
          <Button onClick={() => setModalOpen(true)}>
            Open Modal
          </Button>
          
          <ModalFromDrawer 
            open={modalOpen} 
            onOpenChange={setModalOpen} 
          />
        </div>
      </Drawer>
    </>
  );
}

function ModalFromDrawer({ open, onOpenChange }) {
  const { isInsideDrawer, drawerZIndex } = useDrawerContext();
  
  return (
    <Modal
      open={open}
      onOpenChange={onOpenChange}
      title="Modal from Drawer"
      // Use drawerZIndex to ensure modal appears above drawer
      style={{ zIndex: isInsideDrawer ? drawerZIndex : undefined }}
    >
      <p>This modal appears above the drawer!</p>
    </Modal>
  );
}
```

### useDrawerContext Hook

The `useDrawerContext` hook provides information about the drawer context:

```jsx
import { useDrawerContext } from '@tagaddod/react';

function ComponentInDrawer() {
  const { isInsideDrawer, drawerZIndex } = useDrawerContext();
  
  if (isInsideDrawer) {
    // Component is inside a drawer
    // Use drawerZIndex for proper z-index layering
  }
  
  return <div>Component content</div>;
}
```

**Returns:**
- `isInsideDrawer: boolean` - Whether the component is rendered inside a drawer
- `drawerZIndex: number` - The z-index value to use for modals opened from the drawer (200)

## Visual Customization

### Custom Padding

<Canvas of={DrawerStories.CustomPadding} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Custom Padding Drawer"
  contentPadding="var(--t-space-600)" // 24px padding instead of default 20px
>
  {/* Content */}
</Drawer>
```

The default content padding is `var(--t-space-500)` (20px). You can customize it using design tokens:

- `var(--t-space-300)` = 12px (0.75rem)
- `var(--t-space-400)` = 16px (1rem)
- `var(--t-space-500)` = 20px (1.25rem) - default
- `var(--t-space-600)` = 24px (1.5rem)
- `var(--t-space-700)` = 32px (2rem)

Or use custom values like `"2rem 1rem"` for different vertical and horizontal padding.

### Width Testing

Use the interactive **Custom Width Tester** story to experiment with different width configurations:

<Canvas of={DrawerStories.CustomWidthTester} />

This story provides:
- Live input fields for testing custom width values
- Real-time preview of width changes
- Examples of different CSS units (rem, px, vw, clamp)
- Validation of minimum width constraints


### Full Height

<Canvas of={DrawerStories.FullHeightDrawer} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Full Height Drawer"
  fullHeight={true}
>
  {/* Content */}
</Drawer>
```

## Internationalization and RTL Support

The Drawer component provides comprehensive Right-to-Left (RTL) language support when used with the `ThemeProvider`. This includes automatic font switching, proper drawer positioning, directional icon handling, and Arabic text optimization.

### Using with ThemeProvider

For full RTL support, wrap your application with `ThemeProvider`:

```jsx
import { ThemeProvider, Drawer, Button } from '@tagaddod-design/react';
import { IconArrowLeft, IconArrowRight, IconX } from '@tabler/icons-react';

function App() {
  return (
    <ThemeProvider defaultDirection="rtl" defaultLocale="ar">
      <Drawer
        open={isOpen}
        onOpenChange={setIsOpen}
        title="ÿØÿ±ÿ¨ ÿ¨ÿßŸÜÿ®Ÿä"
        showBackButton={true}
        headerPrefix={<Badge tone="info">ÿ≠ÿßŸÑÿ©</Badge>}
        headerSuffix={<Button variant="plain" size="micro">ÿ•ÿ¨ÿ±ÿßÿ°</Button>}
      >
        <p>ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿØÿ±ÿ¨ ÿ®ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</p>
      </Drawer>
    </ThemeProvider>
  );
}
```

### Automatic RTL Adjustments

When RTL is enabled via ThemeProvider or document direction, the Drawer component automatically:

1. **Font Switching**: Changes from Outfit (English) to Tajawal (Arabic) font family
2. **Drawer Position**: Always opens from left in RTL (following reading direction)  
3. **Header Layout**: Repositions title, prefix, and suffix elements for RTL reading
4. **Line Height**: Applies `var(--t-line-height-arabic, 1.5)` for proper Arabic text rendering
5. **Content Direction**: Sets `dir="rtl"` attribute on drawer content
6. **Animation Direction**: Slide animations respect RTL reading direction (left-to-right)
7. **Button Labels**: Automatically applies Arabic aria-labels for back/close buttons

### Directional Icon Handling

**Important**: The Drawer component includes built-in directional icon logic. When using back arrows or navigation icons, the component automatically chooses the correct direction:

```jsx
import { useEffect, useState } from 'react';
import { Drawer, Button } from '@tagaddod-design/react';
import { IconArrowLeft, IconArrowRight, IconX } from '@tabler/icons-react';

function DirectionalDrawer() {
  const [isRTL, setIsRTL] = useState(false);
  
  useEffect(() => {
    const dir = document.dir || document.documentElement.dir;
    setIsRTL(dir === 'rtl');
  }, []);
  
  // The drawer automatically handles back arrow direction internally:
  // In RTL: back arrow points right (‚Üí) - IconArrowRight
  // In LTR: back arrow points left (‚Üê) - IconArrowLeft
  
  return (
    <Drawer
      open={open}
      onOpenChange={setOpen}
      title={isRTL ? 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™' : 'Settings'}
      showBackButton={true}
      onBackClick={() => {
        // Handle navigation
      }}
      showFooter={true}
      primaryLabel={isRTL ? 'ÿ≠ŸÅÿ∏' : 'Save'}
      cancelLabel={isRTL ? 'ÿ•ŸÑÿ∫ÿßÿ°' : 'Cancel'}
    >
      <div>
        <p>{isRTL ? 'ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™' : 'Settings content'}</p>
      </div>
    </Drawer>
  );
}
```

### RTL Position Logic

The Drawer automatically adjusts its position based on text direction:

```jsx
// Component logic (built-in, no manual configuration needed)
const adjustedPosition = isRTL 
  ? 'left'    // Always left in RTL (follows reading direction)
  : position; // Use provided position in LTR

// This means:
// - In RTL: drawer always slides from left regardless of `position` prop
// - In LTR: drawer uses the provided `position` prop (default: right)
```

### Line Height and Typography

The Drawer applies appropriate line height for Arabic text automatically:

```jsx
// Applied automatically to all text elements in RTL
const lineHeightStyle = {
  lineHeight: isRTL ? 'var(--t-line-height-arabic, 1.5)' : 'var(--t-line-height-english, 1.5)'
};

// Applied to:
// - Drawer title
// - Footer button labels
// - All text content within drawer
```

### RTL Testing Example

<Canvas of={DrawerStories.RTLDrawer} />

```jsx
<div dir="rtl">
  <Drawer
    open={open}
    onOpenChange={setOpen}
    title="ÿπŸÜŸàÿßŸÜ ÿßŸÑÿØÿ±ÿ¨"
    showBackButton={true}
    showFooter={true}
    footerVariant="cancelAndActions"
    primaryLabel="ÿ≠ŸÅÿ∏"
    cancelLabel="ÿ•ŸÑÿ∫ÿßÿ°"
    onPrimary={() => setOpen(false)}
    onCancel={() => setOpen(false)}
  >
    <div style={{ textAlign: 'right' }}>
      <p>Ÿáÿ∞ÿß ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿØÿ±ÿ¨ ÿ®ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ©.</p>
      <p>Ÿäÿ™ŸÖ ÿπÿ±ÿ∂ ÿßŸÑŸÜÿµ ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠ ŸÖÿπ ÿßŸÑŸÖÿ≠ÿßÿ∞ÿßÿ© ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿ©.</p>
    </div>
  </Drawer>
</div>
```

### RTL Best Practices

1. **Always use ThemeProvider** for proper RTL support and automatic font switching
2. **Let drawer handle positioning** - it automatically adjusts slide direction for RTL
3. **Use appropriate Arabic labels** - provide Arabic text for all user-facing strings
4. **Test drawer animations** in RTL to ensure smooth left-to-right transitions  
5. **Consider drawer width** - Arabic text may require different sizing considerations
6. **Test nested components** - ensure all drawer content (modals, selects, etc.) supports RTL
7. **Use semantic HTML** - apply `dir="rtl"` to content containers when needed
8. **Test with real Arabic content** - verify line height and text rendering quality

### Arabic Typography Notes

- The drawer uses `var(--t-line-height-arabic, 1.5)` for optimal Arabic text rendering
- Arabic fonts (Tajawal) are automatically applied via ThemeProvider
- Text direction is set via `dir="rtl"` attribute on drawer content
- All interactive elements (buttons, inputs) inherit proper RTL styling

## Use Cases

### Form Entry

```jsx
import { Badge } from '@tagaddod-design/react';

<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Add New User"
  headerPrefix={<Badge tone="info">Draft</Badge>}
  headerSuffix={<Button variant="plain" size="micro">Save Draft</Button>}
  contentPadding="var(--t-space-600)" // Larger padding for forms
  showFooter={true}
  footerVariant="cancelAndActions"
  cancelLabel="Cancel"
  primaryLabel="Save User"
  onCancel={() => setOpen(false)}
  onPrimary={handleSave}
>
  <form onSubmit={handleSubmit}>
    {/* Form fields */}
  </form>
</Drawer>
```

### Content with Different Padding Needs

```jsx
// Compact content
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Quick Actions"
  contentPadding="var(--t-space-400)" // Smaller 16px padding
>
  {/* Compact action buttons */}
</Drawer>

// Detailed content
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Article Editor"
  contentPadding="var(--t-space-700)" // Larger 32px padding
>
  {/* Rich text editor */}
</Drawer>

// Custom asymmetric padding
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Layout Preview"
  contentPadding="3rem 1rem" // 48px vertical, 16px horizontal
>
  {/* Design preview content */}
</Drawer>
```

### Object Details with Table Data

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title={`Order #${order.id}`}
  showFooter={true}
  primaryAction={{
    label: 'Process Order',
    onClick: handleProcessOrder,
  }}
  secondaryAction={{
    label: 'Close',
    onClick: () => setOpen(false),
  }}
>
  <div>
    {/* Order details */}
    <Table 
      data={orderItems} 
      columns={columns}
      // Table content will appear below the drawer
    />
  </div>
</Drawer>
```

### Multi-step Flows

```jsx
import { Badge } from '@tagaddod-design/react';

<Drawer
  open={open}
  onOpenChange={setOpen}
  title={`Step ${currentStep} of ${totalSteps}`}
  headerPrefix={<Badge tone="warning">In Progress</Badge>}
  showBackButton={currentStep > 1}
  onBackClick={() => setCurrentStep(currentStep - 1)}
  step={currentStep} // Controls back button visibility
  showFooter={true}
  footerVariant="cancelAndActions"
  cancelLabel="Cancel"
  primaryLabel={currentStep === totalSteps ? 'Finish' : 'Next'}
  onCancel={() => setOpen(false)}
  onPrimary={handleNextStep}
>
  <div>
    {/* Step content */}
  </div>
</Drawer>
```

### Settings Panel

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Settings"
  width="default"  // Use default 450px width
  position="right"
>
  <div>
    {/* Settings options */}
  </div>
</Drawer>
```

### Wide Content Drawer

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Data Visualization"
  width="custom"
  customWidth="60rem"    // 960px for wide content
  maxWidth="80vw"        // Responsive maximum
>
  <div>
    {/* Charts, graphs, or wide data tables */}
  </div>
</Drawer>
```

## Accessibility

The Drawer component follows accessibility best practices:

- Uses a modal dialog pattern for proper focus management
- Traps focus within the drawer when open
- Closes on ESC key press
- Uses proper headings for drawer title
- Provides sufficient color contrast
- Handles keyboard navigation properly
- Maintains a logical tab order
- Properly labeled buttons (back, close)
- Uses `aria-label` for buttons without visible text
- Prevents background scrolling when drawer is open

## Implementation Details

### Z-Index Architecture

The Drawer component implements a sophisticated z-index management system:

```css
/* Z-Index Hierarchy */
:root {
  --t-z-drawer-overlay: calc(var(--t-z-modal) + 40);  /* 140 */
  --t-z-drawer-content: calc(var(--t-z-modal) + 50);  /* 150 */
  --t-z-drawer-modal: calc(var(--t-z-modal) + 100);   /* 200 */
}
```

This ensures the drawer always appears above:
- Normal content (`z-index: 0`)
- Dropdowns and selects (`z-index: 10`)
- Standard modals (`z-index: 100`)
- Table sticky headers and content (`z-index: 101`)

### CSS Variables

The Drawer component uses the following token CSS variables:

| Variable | Purpose |
|----------|---------|
| `--t-space-*` | Padding and spacing |
| `--t-color-surface-*` | Background colors |
| `--t-color-fill-*` | Button and background colors |
| `--t-color-border-*` | Border colors |
| `--t-color-text-*` | Text colors |
| `--t-color-icon-*` | Icon colors |
| `--t-font-size-*` | Font sizes |
| `--t-font-weight-*` | Font weights |
| `--t-border-radius-*` | Border radius values |
| `--t-shadow-200` | Shadow for the drawer |
| `--t-z-modal` | Base z-index for modal components |
| `--t-z-drawer-*` | Custom z-index hierarchy for drawers |
| `--t-duration-base` | Animation duration |
| `--t-easing-in-out` | Animation timing function |
| `--t-line-height-arabic` | Line height for Arabic text |
| `--t-line-height-english` | Line height for English text |

### Architecture

The component is built on Vaul's Drawer component which provides:

1. Animation and transitions for smooth entrance/exit
2. Focus management for accessibility
3. Supporting primitives for overlay and content

The Tagaddod implementation extends this with:

1. Design system integration with tokens
2. Multiple sizes and positions
3. Header and footer configurations
4. RTL language support
5. Responsive behavior for mobile devices
6. **Z-index management for complex layouts**
7. **Context provider for nested components**

### Browser Support

The Drawer component is compatible with all modern browsers and includes RTL language support.

### Mobile Behavior

On smaller screens (below 640px):
- The drawer takes the full width of the screen
- It slides up from the bottom instead of from the side
- It has a maximum height of 80% of the viewport
- It uses rounded corners at the top

## Troubleshooting

### Drawer Appears Behind Other Content

If the drawer appears behind other content (like tables or sticky elements):

1. **Check z-index conflicts**: The drawer uses `z-index: 150` by default
2. **Verify CSS custom properties**: Ensure `--t-z-modal` is properly defined
3. **Use utility classes**: Apply `.drawer-modal` class to elements that should appear above the drawer

### Modal Components Not Appearing Above Drawer

When opening modals from within a drawer:

1. **Use useDrawerContext**: Apply the hook to get the correct z-index
2. **Apply drawerZIndex**: Use the returned `drawerZIndex` value for your modal
3. **Check CSS specificity**: Ensure your modal's z-index style has sufficient specificity

### Performance Issues

For large content within drawers:

1. **Use lazy loading**: Load drawer content only when needed
2. **Optimize animations**: Use `prefers-reduced-motion` media query
3. **Limit DOM depth**: Keep drawer content structure simple

## Breaking Changes from Previous Versions

### Z-Index Management
- **Before**: Used undefined `--t-z-index-overlay` token
- **After**: Uses proper token hierarchy with `--t-z-modal` base
- **Migration**: No code changes needed - automatically resolved

### Context Provider
- **Before**: No context provided
- **After**: Provides `DrawerContext` for nested components
- **Migration**: Optional - use `useDrawerContext` for enhanced modal handling

## Complex Component Integration

### Ultimate Z-Index Test: Drawer ‚Üí Modal ‚Üí Select

The Drawer component includes an ultimate stress test story that demonstrates the most complex UI layering scenario possible:

<Canvas of={DrawerStories.UltimateZIndexTest} />

```jsx
import { Drawer, Modal, Select, Button } from '@tagaddod/react';

const UltimateTest = () => {
  const [drawerOpen, setDrawerOpen] = useState(false);
  const [modalOpen, setModalOpen] = useState(false);

  return (
    <>
      <Button onClick={() => setDrawerOpen(true)}>
        Ultimate Z-Index Test
      </Button>
      
      <Drawer open={drawerOpen} onOpenChange={setDrawerOpen} title="Employee Management">
        <div style={{ padding: '20px' }}>
          <Button onClick={() => setModalOpen(true)}>
            Add New Employee
          </Button>
          
          <Modal open={modalOpen} onOpenChange={setModalOpen} title="Add New Employee">
            <div style={{ padding: '16px' }}>
              <Select
                label="Company"
                options={companyOptions}
                placeholder="Select company..."
              />
              <Select
                label="Position"
                options={positionOptions}
                searchable
                placeholder="Search positions..."
              />
              {/* More Select components... */}
            </div>
          </Modal>
        </div>
      </Drawer>
    </>
  );
};
```

**Testing Hierarchy:**
1. **Drawer Opens** ‚Üí Z-index: 1020
2. **Modal Opens from Drawer** ‚Üí Z-index: 1070 (automatic via DrawerContext)
3. **Select Dropdowns in Modal** ‚Üí Z-index: 2147483647 (automatic modal detection)

This demonstrates that the z-index system works correctly in the most complex scenario without any manual configuration.

### Component Integration Features

**Automatic Context Detection:**
- Modal automatically detects it's inside a drawer and uses higher z-index
- Select automatically detects it's inside a modal and uses maximum z-index
- No manual props or configuration required

**Supported Combinations:**
- Drawer + Modal ‚úÖ
- Modal + Select ‚úÖ
- Drawer + Modal + Select ‚úÖ (Ultimate test)
- Drawer + Select ‚úÖ
- Modal + Multiple Selects ‚úÖ

## Best Practices

1. **Use appropriate sizes**: Choose drawer size based on content complexity
2. **Handle modal z-index**: Use `useDrawerContext` when opening modals from drawers (automatic in provided components)
3. **Provide clear actions**: Use footer buttons for primary/secondary actions
4. **Support RTL**: Test drawer behavior in both LTR and RTL languages
5. **Consider mobile**: Design drawer content for smaller screens
6. **Accessibility first**: Ensure keyboard navigation and screen reader compatibility
7. **Test complex scenarios**: Use the Ultimate Z-Index Test story as a reference for complex component nesting
